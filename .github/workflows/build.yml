name: Build for Signulous
on: [push]
jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4

      - name:  Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20 # 专 -20    Native

      - name:  Install Dependencies
        run: |
          npm install
          npm install -g expo-cli

      - name:  Prebuild (Generate iOS Folder)
        run: |
          # 爪专转 转拽转 ios 注  拽 砖 驻
          npx expo prebuild --platform ios --no-install

      - name:  Build App Binary
        run: |
          #  砖 -Project 专住转 Release ( 转)
          xcodebuild -workspace ios/*.xcworkspace \
            -scheme $(ls ios | grep .xcodeproj | cut -f 1 -d '.') \
            -configuration Release \
            -sdk iphoneos \
            -derivedDataPath build \
            CODE_SIGNING_ALLOWED=NO \
            CODE_SIGN_ING_REQUIRED=NO \
            CODE_SIGN_ENTITLEMENTS="" \
            CODE_SIGNING_ID=""

      - name:  Package for Signulous
        run: |
          # 专 砖 -app. 转 转拽转 Payload (  砖 IPA)
          mkdir -p dist/Payload
          cp -r build/Build/Products/Release-iphoneos/*.app dist/Payload/
          cd dist && zip -r SalaryApp.ipa Payload/

      - name:  Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Ready-For-Signulous
          path: dist/SalaryApp.ipa
